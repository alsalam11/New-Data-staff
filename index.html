<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>نموذج بيانات الموظف</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-arabic@1.0.0/dist/jspdf-arabic.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      direction: rtl;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select {
      width: 100%;
      padding: 6px;
      margin-top: 5px;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
    }
  </style>
</head>
<body>

  <h2>نموذج بيانات الموظف</h2>

  <form id="employeeForm">
    <label>الاسم الرباعي واللقب:</label>
    <input type="text" id="fullName" required>

    <label>اسم الأم الثلاثي:</label>
    <input type="text" id="motherName" required>

    <label>تاريخ التولد:</label>
    <input type="date" id="birthDate" required>

    <label>الجنس:</label>
    <select id="gender" required>
      <option value="">-- اختر --</option>
      <option value="ذكر">ذكر</option>
      <option value="أنثى">أنثى</option>
    </select>

    <label>التحصيل الدراسي:</label>
    <input type="text" id="education" required>

    <label>اسم الكلية أو المعهد:</label>
    <input type="text" id="institute" required>

    <label>الاختصاص الدقيق:</label>
    <input type="text" id="specialization" required>

    <label>تاريخ أمر التعيين:</label>
    <input type="date" id="appointmentDate" required>

    <label>تاريخ المباشرة لأول مرة:</label>
    <input type="date" id="startDate" required>

    <label>اسم المدرسة:</label>
    <input type="text" id="school" required>

    <button type="submit">إرسال وتصدير PDF وCSV</button>
  </form>

  <script>
    document.getElementById("employeeForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const data = {
        fullName: document.getElementById("fullName").value,
        motherName: document.getElementById("motherName").value,
        birthDate: document.getElementById("birthDate").value,
        gender: document.getElementById("gender").value,
        education: document.getElementById("education").value,
        institute: document.getElementById("institute").value,
        specialization: document.getElementById("specialization").value,
        appointmentDate: document.getElementById("appointmentDate").value,
        startDate: document.getElementById("startDate").value,
        school: document.getElementById("school").value
      };

      // 🟦 1. إنشاء PDF يدعم العربية
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFont("Amiri", "normal");
      doc.setFontSize(14);

      let y = 20;
      doc.text("استمارة بيانات الموظف", 105, y, { align: "center" });
      y += 10;

      for (let [key, value] of Object.entries(data)) {
        const label = document.querySelector("label[for=" + key + "]")?.innerText || "";
        const labelText = document.querySelector(`label[for="${key}"]`)?.innerText || "";
        const fullText = `${key.replace(/([A-Z])/g, ' $1')}: ${value}`;
        doc.text(fullText, 20, y, { align: "right" });
        y += 10;
      }

      doc.save("بيانات_الموظف.pdf");

      // 🟨 2. إنشاء CSV
      const csvHeader = "الاسم,اسم الأم,تاريخ التولد,الجنس,التحصيل الدراسي,الكلية,الاختصاص,أمر التعيين,المباشرة,المدرسة\n";
      const csvRow = `${data.fullName},${data.motherName},${data.birthDate},${data.gender},${data.education},${data.institute},${data.specialization},${data.appointmentDate},${data.startDate},${data.school}`;
      const blob = new Blob([csvHeader + csvRow], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "بيانات_الموظف.csv";
      link.click();
    });
  </script>
</body>
</html>
