<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>نموذج بيانات الموظف</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // خط Amiri مضمن مسبقاً
    window.jsPDF = window.jspdf;
    window.jspdf.jsPDF.API.events.push(['addFonts', function () {
      this.addFileToVFS("Amiri-Regular.ttf", "AAEAAAASAQAABAAgR0RFRrRCsIIAAZj8AAACYkdQT1P..."); // استبدل ببيانات Base64 الكاملة من ملف amiri-font.js
      this.addFont("Amiri-Regular.ttf", "Amiri", "normal");
    }]);
  </script>
  <style>
    body { font-family: Arial; direction: rtl; padding: 20px; }
    label, input, select, button { display: block; width: 100%; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>نموذج بيانات الموظف</h2>
  <form id="employeeForm">
    <label>الاسم الرباعي واللقب:</label>
    <input type="text" id="fullName" required>
    <label>اسم الأم الثلاثي:</label>
    <input type="text" id="motherName" required>
    <label>تاريخ التولد:</label>
    <input type="date" id="birthDate" required>
    <label>الجنس:</label>
    <select id="gender" required>
      <option value="">-- اختر --</option>
      <option value="ذكر">ذكر</option>
      <option value="أنثى">أنثى</option>
    </select>
    <label>التحصيل الدراسي:</label>
    <input type="text" id="education" required>
    <label>اسم الكلية أو المعهد:</label>
    <input type="text" id="institute" required>
    <label>الاختصاص الدقيق:</label>
    <input type="text" id="specialization" required>
    <label>تاريخ أمر التعيين:</label>
    <input type="date" id="appointmentDate" required>
    <label>تاريخ المباشرة لأول مرة:</label>
    <input type="date" id="startDate" required>
    <label>اسم المدرسة:</label>
    <input type="text" id="school" required>
    <label>الصورة الشخصية:</label>
    <input type="file" id="photo" accept="image/*">
    <label>وجه البطاقة:</label>
    <input type="file" id="idFront" accept="image/*">
    <label>ظهر البطاقة:</label>
    <input type="file" id="idBack" accept="image/*">
    <button type="submit">إرسال وتحميل PDF + CSV</button>
  </form>  <script>
    document.getElementById("employeeForm").addEventListener("submit", async e => {
      e.preventDefault();
      const keys = ["fullName", "motherName", "birthDate", "gender", "education", "institute", "specialization", "appointmentDate", "startDate", "school"];
      const data = {};
      keys.forEach(k => data[k] = document.getElementById(k).value);

      const imgs = await Promise.all(["photo", "idFront", "idBack"].map(id => {
        const f = document.getElementById(id).files[0];
        if (!f) return null;
        return new Promise(res => {
          const r = new FileReader();
          r.onload = () => res(r.result);
          r.readAsDataURL(f);
        });
      }));

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFont("Amiri");
      doc.setFontSize(12);
      let y = 20;
      doc.text("استمارة بيانات الموظف", 180, y, { align: "right" });
      y += 10;

      const labels = {
        fullName: "الاسم الرباعي واللقب",
        motherName: "اسم الأم الثلاثي",
        birthDate: "تاريخ التولد",
        gender: "الجنس",
        education: "التحصيل الدراسي",
        institute: "اسم الكلية أو المعهد",
        specialization: "الاختصاص الدقيق",
        appointmentDate: "تاريخ أمر التعيين",
        startDate: "تاريخ المباشرة لأول مرة",
        school: "اسم المدرسة"
      };

      keys.forEach(k => {
        doc.text(labels[k] + ": " + data[k], 180, y, { align: "right" });
        y += 8;
      });

      [["الصورة الشخصية", imgs[0]], ["وجه البطاقة", imgs[1]], ["ظهر البطاقة", imgs[2]]]
        .forEach(([lbl, img]) => {
          if (img) {
            doc.text(lbl, 180, y, { align: "right" });
            y += 5;
            doc.addImage(img, "JPEG", 130, y, 50, 50);
            y += 55;
          }
        });

      doc.save("بيانات_الموظف.pdf");

      const csvHeader = keys.map(k => labels[k]).join(",") + "\n";
      const csvRow = keys.map(k => data[k]).join(",") + "\n";
      const blob = new Blob([csvHeader + csvRow], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "بيانات_الموظف.csv";
      a.click();
    });
  </script></body>
</html>
