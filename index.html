<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>التحقق واستكمال بيانات المعلم</title>
<style>
  body { font-family: Arial, sans-serif; direction: rtl; padding: 20px; background: #f5f5f5; }
  .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px #ccc; }
  label, input, button { width: 100%; margin: 10px 0; font-size: 16px; }
  input { padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
  button { background: #005aab; color: white; border: none; padding: 12px; font-weight: bold; border-radius: 8px; cursor: pointer; }
  .hidden { display: none; }
  .error { color: red; margin-top: 5px; }
</style>
</head>
<body>

<div class="container" id="verify-section">
  <h2 style="text-align:center;">التحقق من كادر المدرسة</h2>
  <label for="school">اسم المدرسة:</label>
  <input type="text" id="school" placeholder="مثال: مدرسة تل السلام الابتدائية للبنين" />
  <label for="teacher">اسم المعلم:</label>
  <input type="text" id="teacher" placeholder="مثال: عباس جاسم راضي" />
  <button id="verify-btn">تحقق</button>
  <p id="error-msg" class="error"></p>
</div>

<div class="container hidden" id="form-section">
  <h2 style="text-align:center;">استمارة بيانات المعلم</h2>
  <form id="teacher-form">
    <label>الاسم الرباعي واللقب:</label><input name="fullname" required />
    <label>اسم الأم الثلاثي:</label><input name="mother" required />
    <label>تاريخ التولد:</label><input type="date" name="dob" required />
    <label>محل الولادة:</label><input name="birthplace" required />
    <label>رقم البطاقة الوطنية الموحدة:</label><input name="id" required />
    <label>تاريخ اصدارها:</label><input type="date" name="idIssue" required />
    <label>الجهة الصادرة منها:</label><input name="issuer" required />
    <label>الحالة الزوجية:</label><input name="status" required />
    <label>اسم الزوج/ة:</label><input name="spouse" />
    <label>عنوان السكن (المحافظة - القضاء - الحي):</label><input name="address" required />
    <label>التحصيل الدراسي:</label><input name="education" required />
    <label>الكلية أو المعهد:</label><input name="institute" required />
    <label>تاريخ التعيين:</label><input type="date" name="hire" required />
    <label>تاريخ المباشرة لأول مرة:</label><input type="date" name="first" required />
    <label>تاريخ المباشرة في المدرسة الحالية:</label><input type="date" name="current" required />
    <button type="submit">توليد PDF رسمي</button>
  </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  const المعلمين = [
    { المدرسة: "مدرسة تل السلام الابتدائية للبنين", الاسم: "عباس جاسم راضي" },
    { المدرسة: "مدرسة تل السلام الابتدائية للبنين", الاسم: "علاء ناصر كامل" },
    { المدرسة: "مدرسة تل السلام الابتدائية للبنين", الاسم: "اسماء محمد فرحان" },
    { المدرسة: "مدرسة تل السلام الابتدائية للبنين", الاسم: "ظاهر حمدان شنبار" },
    { المدرسة: "مدرسة تل السلام الابتدائية للبنين", الاسم: "عيسى محمد فارس" }
  ];

  const verifyBtn = document.getElementById("verify-btn");
  const errorMsg = document.getElementById("error-msg");
  const verifySection = document.getElementById("verify-section");
  const formSection = document.getElementById("form-section");

  verifyBtn.addEventListener("click", () => {
    const schoolVal = document.getElementById("school").value.trim().toLowerCase();
    const teacherVal = document.getElementById("teacher").value.trim().toLowerCase();

    const موجود = المعلمين.some(entry =>
      entry.المدرسة.trim().toLowerCase() === schoolVal &&
      entry.الاسم.trim().toLowerCase() === teacherVal
    );

    if (موجود) {
      errorMsg.textContent = "";
      verifySection.classList.add("hidden");
      formSection.classList.remove("hidden");
      document.querySelector("input[name='fullname']").value = document.getElementById("teacher").value.trim();
    } else {
      errorMsg.textContent = "❌ اسم المدرسة أو المعلم غير صحيح. حاول مرة أخرى.";
    }
  });

  document.getElementById("teacher-form").addEventListener("submit", (e) => {
    e.preventDefault();

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: "pt", format: "a4" });
    const margin = 40;
    let y = margin;

    const pageWidth = doc.internal.pageSize.getWidth();
    const pageHeight = doc.internal.pageSize.getHeight();

    // إطار الصفحة
    doc.setDrawColor(0);
    doc.setLineWidth(1);
    doc.rect(margin / 2, margin / 2, pageWidth - margin, pageHeight - margin);

    // شعار الوزارة (نصّي)
    doc.setFontSize(24);
    doc.text("وزارة التربية العراقية", pageWidth / 2, y, { align: "center" });
    y += 30;

    // ترويسة رسمية
    doc.setFontSize(18);
    doc.text("المديرية العامة للتربية في محافظة البصرة", pageWidth / 2, y, { align: "center" });
    y += 40;

    // عنوان الاستمارة
    doc.setFontSize(16);
    doc.text("استمارة بيانات المعلم", pageWidth / 2, y, { align: "center" });
    y += 40;

    const formData = new FormData(e.target);

    const labels = [
      "الاسم الرباعي واللقب",
      "اسم الأم الثلاثي",
      "تاريخ التولد",
      "محل الولادة",
      "رقم البطاقة الوطنية الموحدة",
      "تاريخ اصدارها",
      "الجهة الصادرة منها",
      "الحالة الزوجية",
      "اسم الزوج/ة",
      "عنوان السكن (المحافظة - القضاء - الحي)",
      "التحصيل الدراسي",
      "الكلية أو المعهد",
      "تاريخ التعيين",
      "تاريخ المباشرة لأول مرة",
      "تاريخ المباشرة في المدرسة الحالية"
    ];

    const fields = [
      "fullname", "mother", "dob", "birthplace", "id", "idIssue", "issuer", "status",
      "spouse", "address", "education", "institute", "hire", "first", "current"
    ];

    doc.setFontSize(14);

    for (let i = 0; i < labels.length; i++) {
      let value = formData.get(fields[i]);
      if (fields[i].includes("dob") || fields[i].includes("Issue") || fields[i].includes("hire") || fields[i].includes("first") || fields[i].includes("current")) {
        if (value) {
          const d = new Date(value);
          value = d.toLocaleDateString('ar-EG');
        }
      }
      doc.text(`${labels[i]}: ${value || "غير محدد"}`, margin, y);
      y += 25;
      if (y > pageHeight - margin) {
        doc.addPage();
        y = margin;
      }
    }

    doc.save("استمارة_المعلم.pdf");
  });
</script>

</body>
</html>
